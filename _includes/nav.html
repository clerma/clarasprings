<nav class="navbar navbar-expand-lg">
  <div class="container">

    <!-- Logo -->
    <div class="logo-wrapper">
      <a class="logo" href="/">
        <img src="{{ site.data.company.logo_image }}" class="logo-img" alt="">
      </a>
    </div>

    <!-- Mobile Toggle -->
    <button class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbar"
            aria-controls="navbar"
            aria-expanded="false"
            aria-label="Toggle navigation">
      <span class="navbar-toggler-icon">
        <i class="ti-menu"></i>
      </span>
    </button>

    <!-- Navigation -->
    <div class="collapse navbar-collapse" id="navbar">
      <ul class="navbar-nav ms-auto">

        {% assign current = page.url | append: "/" | replace: "//", "/" %}

        {% for item in site.data.navigation %}

          {% assign item_url = item.url | append: "/" | replace: "//", "/" %}
          {% assign is_active = false %}

          {% if current == item_url %}
            {% assign is_active = true %}
          {% endif %}

          {% comment %}
          Detect active children
          {% endcomment %}

          {% assign rendered_children = nil %}

          {% if item.children %}

            {% assign rendered_children = "" | split: "" %}

            {% for child in item.children %}

              {% if child._collection %}
                {% assign docs = site[child._collection]
                  | where: "published", true
                  | sort: child.sort_by %}

                {% for doc in docs limit: child.limit %}
                  {% capture child_url %}{{ doc.url | append: "/" | replace: "//", "/" }}{% endcapture %}

                  {% if current == child_url %}
                    {% assign is_active = true %}
                  {% endif %}

                  {% assign rendered_children = rendered_children | push: doc %}
                {% endfor %}

              {% else %}
                {% assign child_url = child.url | append: "/" | replace: "//", "/" %}

                {% if current == child_url %}
                  {% assign is_active = true %}
                {% endif %}

                {% assign rendered_children = rendered_children | push: child %}
              {% endif %}

            {% endfor %}
          {% endif %}

          {% if item.children %}

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle{% if is_active %} active{% endif %}"
                 href="#"
                 role="button"
                 data-bs-toggle="dropdown"
                 data-bs-auto-close="outside"
                 aria-expanded="false">
                {{ item.label }} <i class="ti-angle-down"></i>
              </a>

              <ul class="dropdown-menu">

                {% for child in rendered_children %}
                  {% if child.url %}
                    {% assign child_link = child.url %}
                    {% assign child_label = child.label %}
                  {% else %}
                    {% assign child_link = child.url %}
                    {% assign child_label = child.title %}
                  {% endif %}

                  {% assign child_url = child_link | append: "/" | replace: "//", "/" %}

                  <li>
                    <a href="{{ child_link }}"
                       class="dropdown-item{% if current == child_url %} active{% endif %}">
                      <span>{{ child_label }}</span>
                    </a>
                  </li>
                {% endfor %}

              </ul>
            </li>

          {% else %}

            <li class="nav-item">
              {% if item.label == 'Donate' %}
              <div class="butn-1">
              <a class="{% if is_active %} active{% endif %}"
                 href="{{ item.url }}">
                <span>{{ item.label }}</span>
              </a>
              </div>
              {% else %}
              <a class="nav-link{% if is_active %} active{% endif %}"
                 href="{{ item.url }}">
                {{ item.label }}
              </a>
              {% endif %}
            </li>

          {% endif %}

        {% endfor %}

      </ul>
    </div>
  </div>
</nav>
